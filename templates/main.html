{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="hero-container">
    <div class="hero-content">
        <h1>Ваш персональный медицинский ассистент с ИИ</h1>
        <p>Мгновенный доступ к квалифицированной помощи — круглосуточно и заботой о вашем здоровье</p>
        <div class="button-group">
            <a href="{% url 'chat' %}" class="primary-btn">
                <i class="fas fa-robot"></i> Начать
            </a>
            <a href="{% url 'about' %}" class="secondary-btn">
                <i class="fas fa-info-circle"></i> Узнать больше
            </a>
        </div>
    </div>
    <div class="hero-image">
        <img src="{% static 'images/doctor-icon.svg' %}" alt="Doctor">
    </div>
</div>

<section id="usluga" class="features">
    <div class="features-container">
        <h2>Наши возможности</h2>
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">
                <i class="fas fa-user-md"></i>
                </div>
                <h3>Консультации</h3>
                <p>Получайте рекомендации по любым медицинским вопросам</p>
                <a href="{% url 'chat' %}" class="feature-btn primary-btn">
                    <i class="fas fa-arrow-right"></i> Начать консультацию
                </a>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                <i class="fas fa-calendar-check"></i>
                </div>
                <h3>Управление записями</h3>
                <p>Записывайтесь на прием и отслеживайте свои визиты</p>
                <a href="{% url 'chat' %}" class="feature-btn primary-btn">
                    <i class="fas fa-calendar-plus"></i> Записаться
                </a>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                <i class="fas fa-heart"></i>
                </div>
                <h3>Забота о здоровье</h3>
                <p>Получайте напоминания и советы для поддержания здоровья</p>
                <a href="{% url 'chat' %}" class="feature-btn primary-btn">
                    <i class="fas fa-bell"></i> Получить советы
                </a>
            </div>
        </div>
    </div>
</section>

<section class="faq-section">
    <div class="faq-container">
        <h2>Найдите ответы на ваши вопросы</h2>
        <div class="faq-list">
            <div class="faq-item">
                <h3>Как Med-Assistant может помочь мне?</h3>
                <div class="faq-content"></div>
            </div>
            <div class="faq-item">
                <h3>Это безопасно для моих данных?</h3>
                <div class="faq-content"></div>
            </div>
            <div class="faq-item">
                <h3>Как начать пользоваться сервисом?</h3>
                <div class="faq-content"></div>
            </div>
        </div>
    </div>
</section>

<section class="map-section">
    <div class="map-container">
        <h2 class="map-title">
            <i class="fas fa-hospital"></i> Больницы в Бишкеке
        </h2>
        <div class="map-filters">
            <button class="filter-btn active" onclick="showAll()">
                <i class="fas fa-hospital"></i> Все
            </button>
            <button class="filter-btn" onclick="filterMarkers('private')">
                <i class="fas fa-building"></i> Частные
            </button>
            <button class="filter-btn" onclick="filterMarkers('state')">
                <i class="fas fa-landmark"></i> Государственные
            </button>
        </div>
        <div class="map-wrapper">
            <div id="map" class="map"></div>
            <div id="map-error" class="map-error" style="display: none;">
                <i class="fas fa-exclamation-circle"></i>
                <p>Не удалось загрузить карту. Пожалуйста, попробуйте позже.</p>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block footer %}
<footer class="footer">
    <div class="footer-content">
        <div class="footer-section">
            <div class="footer-brand">
                <a href="{% url 'home' %}" class="footer-logo">
                    <i class="fas fa-heartbeat"></i>
                    <span>Medical Assistant</span>
                </a>
                <p class="footer-description">Ваш персональный медицинский ассистент, доступный 24/7</p>
            </div>
            <div class="social-links">
                <a href="#" class="social-link"><i class="fab fa-telegram"></i></a>
                <a href="#" class="social-link"><i class="fab fa-vk"></i></a>
                <a href="#" class="social-link"><i class="fab fa-whatsapp"></i></a>
            </div>
        </div>
        
        <div class="footer-section">
            <h3>О компании</h3>
            <ul>
                <li><a href="{% url 'about' %}">О нас</a></li>
                <li><a href="#">Политика конфиденциальности</a></li>
                <li><a href="#">Условия использования</a></li>
            </ul>
        </div>
        
        <div class="footer-section">
            <h3>Контакты</h3>
            <ul>
                <li><i class="fas fa-phone"></i> +7,000 000 00 00</li>
                <li><i class="fas fa-envelope"></i> info@medassistant.ru</li>
                <li><i class="fas fa-map-marker-alt"></i> г. Бишкек, ул. Примерна, д. 123</li>
                <li><i class="fas fa-clock"></i> Пн-Пт: 09:00 - 18:00</li>
            </ul>
        </div>
    </div>
    
    <div class="footer-bottom">
        <p>© 2024 Medical Assistant, Все права защищены</p>
    </div>
</footer>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/clinics-data.js' %}"></script>
<script>
// Глобальные переменные для карты
let map;
let markers = [];

// Инициализация карты
function initMap() {
    console.log('Инициализация карты...');
    const mapElement = document.getElementById('map');
    const errorElement = document.getElementById('map-error');
    
    if (!mapElement) {
        console.error('Элемент карты не найден');
        return;
    }
    
    try {
        // Проверяем, загружен ли API Яндекс.Карт
        if (typeof ymaps === 'undefined') {
            console.error('API Яндекс.Карт не загружен');
            mapElement.style.display = 'none';
            errorElement.style.display = 'flex';
            return;
        }
        
        console.log('API Яндекс.Карт загружен, создаем карту');
        
        ymaps.ready(function() {
            console.log('ymaps.ready вызван');
            
            map = new ymaps.Map("map", {
                center: [42.8746, 74.5698], // Бишкек
                zoom: 12,
                controls: ['zoomControl', 'fullscreenControl']
            });
            
            console.log('Карта создана');
            
            // Показываем все клиники по умолчанию
            showAll();
        });
    } catch (error) {
        console.error('Ошибка при инициализации карты:', error);
        mapElement.style.display = 'none';
        errorElement.style.display = 'flex';
    }
}

// Функция для отображения всех клиник
function showAll() {
    clearMarkers();
    const allClinics = getAllClinics();
    allClinics.forEach(clinic => {
        addMarker(clinic);
    });
    updateMapBounds();
}

// Функция для фильтрации маркеров по типу
function filterMarkers(type) {
    clearMarkers();
    const filteredClinics = getClinicsByType(type);
    filteredClinics.forEach(clinic => {
        addMarker(clinic);
    });
    updateMapBounds();
}

// Функция для добавления маркера
function addMarker(clinic) {
    const marker = new ymaps.Placemark(clinic.coordinates, {
        balloonContent: `<strong>${clinic.name}</strong><br>${clinic.address}`,
        hintContent: clinic.name
    }, {
        preset: clinic.type === 'state' ? 'islands#redMedicalIcon' : 'islands#blueMedicalIcon'
    });
    
    markers.push(marker);
    map.geoObjects.add(marker);
}

// Функция для очистки всех маркеров
function clearMarkers() {
    markers.forEach(marker => {
        map.geoObjects.remove(marker);
    });
    markers = [];
}

// Функция для обновления границ карты
function updateMapBounds() {
    if (markers.length > 0) {
        map.setBounds(map.geoObjects.getBounds(), {
            checkZoomRange: true
        });
    }
}

// Инициализация карты при загрузке страницы
document.addEventListener('DOMContentLoaded', initMap);
</script>
{% endblock %}